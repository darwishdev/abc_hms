[
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<div class=\"end-of-day-container\">\n        <div class=\"end-of-day-title\">\n            Hotel Operations\n            <span class=\"status-indicator\"></span>\n        </div>\n        <button class=\"end-of-day-button\" id=\"endOfDayBtn\">\n            <span class=\"button-icon\">ðŸŒ™</span>\n            End of Day\n        </button>\n    </div>",
  "modified": "2025-09-22 10:53:11.298618",
  "name": "End Of Day",
  "private": 0,
  "roles": [],
  "script": "\n$(document).ready(function () {\n    const property = \"CONA\";\n    $(root_element)\n        .find(\"#endOfDayBtn\")\n        .on(\"click\", function () {\n            frappe.confirm(\n                \"Are you sure you want to run the End of Day process?\",\n                function () {\n                    frappe\n                        .call(\"abc_hms.enqueue_property_end_of_day\", {\n                            property,\n                            auto_mark_no_show: false,\n                            auto_session_close: false,\n                        })\n                        .then((respnse) => {\n                            console.log(\"repsonse is\", response);\n                        })\n                        .catch((err) => {\n                            const response = err?.responseJSON;\n                            console.log(\n                                response?.exc_type === \"EndOfDayValidationError\",\n                                response,\n                            );\n                            if (response?.exc_type === \"EndOfDayValidationError\") {\n                                let validation_result;\n                                try {\n                                    const excStr = response.exception;\n                                    const jsonPart = excStr.slice(excStr.indexOf(\"{\"));\n                                    validation_result = JSON.parse(jsonPart).data;\n                                } catch (e) {\n                                    console.error(\"Failed to parse validation result:\", e);\n                                }\n                                let data = [];\n                                if (validation_result.arrivals?.length) {\n                                    data.push({\n                                        type: \"Arrivals\",\n                                        items: validation_result.arrivals,\n                                    });\n                                }\n                                if (validation_result.departures?.length) {\n                                    data.push({\n                                        type: \"Departures\",\n                                        items: validation_result.departures,\n                                    });\n                                }\n                                if (validation_result.sessions?.length) {\n                                    data.push({\n                                        type: \"Sessions\",\n                                        items: validation_result.sessions,\n                                    });\n                                }\n\n                                // Optional: show in a simple Frappe dialog table\n                                if (validation_result) {\n                                    const { arrivals, departures, sessions } = validation_result;\n\n                                    // Helper to convert structured data into table rows\nconst dialog = new frappe.ui.Dialog({\n    title: __(\"End Of Day Validation Failed\"),\n    fields: [\n        { fieldtype: \"HTML\", fieldname: \"arrivals_table\" },\n        { fieldtype: \"HTML\", fieldname: \"departures_table\" },\n        { fieldtype: \"HTML\", fieldname: \"sessions_table\" }\n    ]\n});\n\ndialog.show();\n\n// Render Arrivals DataTable\nif (arrivals?.length) {\n    const $arrivals = dialog.fields_dict.arrivals_table.$wrapper;\n    new frappe.DataTable($arrivals[0], {\n        columns: [\n            { label: \"Reservation\", fieldname: \"reservation\", fieldtype: \"Link\", options: \"Reservation\" },\n            { label: \"Guest\", fieldname: \"guest\", fieldtype: \"Link\", options: \"Customer\" },\n            { label: \"Room Type\", fieldname: \"room_type\", fieldtype: \"Link\", options: \"Room Type\" },\n            { label: \"Room\", fieldname: \"room\", fieldtype: \"Link\", options: \"Room\" },\n            { label: \"Base Rate\", fieldname: \"base_rate\", fieldtype: \"Currency\" }\n        ],\n        data: arrivals,\n        inlineFilters: false,\n        layout: \"fixed\",\n        disableReorderColumn: true,\n        events: {\n            onRowClick(data) {\n                // Navigate when clicking reservation\n                const reservation = data.reservation;\n                if (reservation) {\n                    window.open(`/app/reservation/${reservation}`, \"_blank\");\n                }\n            }\n        }\n    });\n}\n\n// Do the same for Departures and Sessions\n\n                                }\n                            } else {\n                                console.error(\"Unhandled error:\", err);\n                            }\n                        });\n                },\n                function () {\n                    console.log(\"cancelled\");\n                    frappe.show_alert({\n                        message: \"End of Day cancelled\",\n                        indicator: \"orange\",\n                    });\n                },\n            );\n        });\n});\n",
  "style": "<style>\n        .end-of-day-container {\n            padding: 20px;\n            text-align: center;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            border-radius: 12px;\n            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\n            margin: 10px 0;\n        }\n\n        .end-of-day-button {\n            background: #ffffff;\n            color: #667eea;\n            border: none;\n            padding: 15px 30px;\n            font-size: 18px;\n            font-weight: 600;\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\n            display: inline-flex;\n            align-items: center;\n            gap: 10px;\n        }\n\n        .end-of-day-button:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);\n            background: #f8f9ff;\n        }\n\n        .end-of-day-button:active {\n            transform: translateY(0);\n        }\n\n        .button-icon {\n            font-size: 20px;\n        }\n\n        .end-of-day-title {\n            color: white;\n            margin-bottom: 15px;\n            font-size: 16px;\n            font-weight: 500;\n        }\n\n        .status-indicator {\n            display: inline-block;\n            width: 8px;\n            height: 8px;\n            border-radius: 50%;\n            background: #4caf50;\n            margin-left: 8px;\n            animation: pulse 2s infinite;\n        }\n\n        @keyframes pulse {\n            0% { opacity: 1; }\n            50% { opacity: 0.5; }\n            100% { opacity: 1; }\n        }\n    </style>"
 }
]